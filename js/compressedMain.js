var Shaders={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","gl_FragColor = vec4( diffuse, 1 );","}"].join("\n")},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = 0;","gl_Position = 0;","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = 0;","gl_FragColor = 0;","}"].join("\n")}},ShadersOverlay={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","gl_FragColor = vec4( diffuse, 0.5 );","}"].join("\n")},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 0.6 );","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = pow( 0.1 - dot( vNormal, vec3( 0, 2.1, 0.0 ) ), 8.0 );","gl_FragColor = vec4( 0, 0.5, 1, 0.8 ) * intensity;","}"].join("\n")}},Globe=function(){function e(e,t,n,i){var a=(90-e)*Math.PI/180,o=(180-t)*Math.PI/180;P.aws.regions[i].pivot.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-C));var r=new THREE.PlaneGeometry(0,0,1);r.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-C));var s=new THREE.Mesh(r,n);s.position.x=b*Math.sin(a)*Math.cos(o),s.position.y=b*Math.cos(a),s.position.z=b*Math.sin(a)*Math.sin(o),s.scale.z=Math.max(1,.1),s.lookAt(f.position),s.name=i,s.type="region",g.add(s),s.add(P.aws.regions[i].pivot);var l=new THREE.Object3D;l.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,C/2)),P.aws.regions[i].pivot.add(l),r=new THREE.ConeGeometry(3,C,4,1,!0,Math.PI/4,2*Math.PI);var d=new THREE.MeshBasicMaterial({map:_,transparent:!0,depthWrite:!1,depthTest:!1,opacity:.3}),E=new THREE.Mesh(r,d);E.name=i+"Cone",g.add(E),l.add(E),l.rotation.x+=O,(r=new THREE.PlaneGeometry(1,1,1)).applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-C-2));var p=new THREE.Mesh(r,n);s.add(p)}function t(e){var t=[];for(var i in inventory)for(var a in inventory[i])inventory[i][a].Region==e&&t.push(inventory[i][a]);var o,r,s,l=Math.ceil(Math.sqrt(t.length)),d=Math.round(Math.sqrt(t.length)),E=g.getObjectByName(e),p=4*l,v=4*d,c=0,h=0,y=0,m=0,w=!1,u=0,T=0;for(o=0;o<t.length;o++){for(s=!1,u=1==d?4*c-(4*d-4):4*c-(4*d-4)/2,T=1==l?4*y-(4*l-4):4*y-(4*l-4)/2,r=0;r<E.children[0].children.length;r++)if(E.children[0].children[r].name==t[o].id){E.children[0].children[r].position.x=u,E.children[0].children[r].position.y=T,s=!0;break}s||n(t[o],u,T),c>h&&(h=c),y>m&&(m=y),y>c?w?y==c+1?(w=!1,c++,y=0):c++:(c++,y=0):y<c?y++:y==c&&(w||(y++,c=0,w=!0))}v<4&&(v=4),p<4&&(p=4),E.children[1].scale.set(v+2,p+2,1)}function n(e,t,n){var i,a,o=new THREE.MeshLambertMaterial({map:m(e),transparent:!0,side:THREE.DoubleSide,opacity:.9});if("elb"==e.type){i=1,a=new THREE.Geometry,o.wireframe=!0;var r=new THREE.OctahedronGeometry(1.4,2);r.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-2.5));var s=new THREE.Mesh(r,o),l={left:0,center:0,right:0},d={left:0,center:0,right:0};.1,.6,d.center=-1.4,d.left=d.center,d.right=d.center,l.left=.8,l.right=-.8;var E=new THREE.BoxGeometry(.1,.6,.5);E.applyMatrix((new THREE.Matrix4).makeTranslation(l.center,d.center,-2.5));var p=new THREE.Mesh(E,o),v=new THREE.BoxGeometry(.1,.6,.5);v.applyMatrix((new THREE.Matrix4).makeTranslation(l.left,d.left,-2.5));var c=new THREE.Mesh(v,o),h=new THREE.BoxGeometry(.1,.6,.5);h.applyMatrix((new THREE.Matrix4).makeTranslation(l.right,d.right,-2.5));var y=new THREE.Mesh(h,o),w=new THREE.BoxGeometry(.1,.6,.5);w.applyMatrix((new THREE.Matrix4).makeTranslation(-l.center,-d.center,-2.5));var u=new THREE.Mesh(w,o);a.merge(s.geometry,s.matrix),a.merge(p.geometry,p.matrix),a.merge(c.geometry,c.matrix),a.merge(y.geometry,y.matrix),a.merge(u.geometry,u.matrix)}else"apigateway"==e.type&&(i=3,(a=new THREE.TorusGeometry(1.5,.2,10,28)).applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-.5)),o.wireframe=!0);var T=new THREE.Mesh(a,o);T.scale.z=Math.max(i,.1),T.lookAt(f.position),T.name=e.id,T.type=e.type,T.position.x=t,T.position.y=n,T.position.z=0,g.add(T),void 0!=e.Region&&P.aws.regions[e.Region].pivot.add(T),inventory[e.type][e.id].mesh=T,g.updateMatrixWorld(!0)}function i(e){var t=document.createElement("canvas");return t.width=256,t.height=256,t.getContext("2d").fillStyle=e,t.getContext("2d").fillRect(0,0,256,256),new THREE.CanvasTexture(t)}function a(){new Audio("sounds/Tick-DeepFrozenApps-397275646.mp3").play(),document.getElementById("enhanceFrame").style.display="block",setTimeout(function(){document.getElementById("enhanceFrame").style.display="none",h((F-210)/1.5)},100)}function o(e){e.preventDefault(),S=!0,M.addEventListener("mousemove",r,!1),M.addEventListener("mouseup",s,!1),M.addEventListener("mouseout",l,!1),B.x=-e.clientX,B.y=e.clientY,G.x=j.x,G.y=j.y}function r(e){k.x=e.clientX/window.innerWidth*2-1,k.y=-e.clientY/window.innerHeight*2+1,S&&(H=L/1e3,j.x=G.x+.005*(-e.clientX-B.x)*H,j.y=G.y+.005*(e.clientY-B.y)*H,j.y=j.y>O?O:j.y,j.y=j.y<-O?-O:j.y)}function s(e){S=!1,M.removeEventListener("mousemove",r,!1),M.removeEventListener("mouseup",s,!1),M.removeEventListener("mouseout",l,!1)}function l(e){M.removeEventListener("mousemove",r,!1),M.removeEventListener("mouseup",s,!1),M.removeEventListener("mouseout",l,!1)}function d(e){return e.preventDefault(),R&&h(.3*e.wheelDeltaY),!1}function E(e){switch(e.keyCode){case 13:"password"==document.activeElement.id&&loginAndLoadInventory(),e.preventDefault();break;case 16:holdingShift=!0,e.preventDefault();break;case 17:toggleRotate(),e.preventDefault();break;case 18:holdingAlt=!0,e.preventDefault();break;case 37:holdingAlt?j.x-=3:j.x-=.1,e.preventDefault();break;case 38:holdingShift?(j.y+=.05,j.y=j.y>O?O:j.y,j.y=j.y<-O?-O:j.y):h(20),e.preventDefault();break;case 39:holdingAlt?j.x+=3:j.x+=.1,e.preventDefault();break;case 40:holdingShift?(j.y-=.05,j.y=j.y>O?O:j.y,j.y=j.y<-O?-O:j.y):h(-20),e.preventDefault();break;default:new Audio("sounds/Pen_Clicks-Simon_Craggs-514025171.mp3").play()}}function p(e){void 0==e?e=20:e--,0!=e?setTimeout(function(){j.x+=e/3,p(e)},10):startRotation()}function v(e){switch(e.keyCode){case 16:holdingShift=!1,e.preventDefault();break;case 18:holdingAlt=!1,e.preventDefault()}}function c(e){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),T.setSize(window.innerWidth,window.innerHeight)}function h(e){e>0?(slidePanes("out"),stopRotation()):slidePanes("in"),F=(F=(F-=e)>1e3?1e3:F)<210?210:F}function y(){D.x+=.1*(j.x-D.x),D.y+=.1*(j.y-D.y),L+=.3*(F-L),u.position.x=L*Math.sin(D.x)*Math.cos(D.y),u.position.y=L*Math.sin(D.y),u.position.z=L*Math.cos(D.x)*Math.cos(D.y),u.lookAt(f.position),rotate&&(j.x-=.001),T.render(g,u),frames++}function m(e){return"fail"==e.health?W:"running"==e.status?void 0!=e.cpu&&void 0!=e.cpu.Average?e.cpu.Average>=0&&e.cpu.Average<75?A:e.cpu.Average>=75&&e.cpu.Average<90?N:U:A:"pending"==e.status||"rebooting"==e.status||"creating"==e.status?_:"stopped"==e.status?q:"stopping"==e.status||"shutting-down"==e.status?V:void 0}function w(e,t,n){var i=!0;F=1e3,Math.abs(u.position.x-e)>500||n>0&&u.position.z<0||n<0&&u.position.z>0?(j.x-=.03,i=!1):Math.abs(u.position.x-e)>400||n>0&&u.position.z<0||n<0&&u.position.z>0?(j.x-=.01,i=!1):(Math.abs(u.position.x-e)>100||n>0&&u.position.z<0||n<0&&u.position.z>0)&&(j.x-=.001,i=!1),Math.abs(u.position.y-t)>100&&(u.position.y<t?j.y+=.01:j.y-=.01,i=!1),i?stopRotation():setTimeout(function(){w(e,t,n)},10)}var u,g,T,f,R,H,M=document.getElementById("container"),x="images/",b=200,S=!1,C=15,k=(new THREE.Raycaster,new THREE.Vector2),B={x:0,y:0},D={x:0,y:0},j={x:3*Math.PI/2.5,y:Math.PI/7},G={x:0,y:0},L=1e5,F=1e3,O=Math.PI/2,P={},I=document.createElement("canvas");I.width=256,I.height=256;var z=I.getContext("2d").createLinearGradient(256,0,256,256);z.addColorStop(0,"#0080ff"),z.addColorStop(.2,"#0065ff"),z.addColorStop(.5,"#0055ff"),z.addColorStop(.8,"#0065ff"),z.addColorStop(1,"#0080ff"),I.getContext("2d").fillStyle=z,I.getContext("2d").fillRect(0,0,256,256);var A=new THREE.CanvasTexture(I),W=(i("rgb(256,256,256)"),i("rgb(256,0,0)")),N=i("rgb(256,256,0)"),U=i("rgb(179, 71, 0)"),_=i("rgb(256,256,256)"),q=i("rgb(50,50,50)"),V=q,Y=i("rgb(0, 173, 239)"),X=null,J=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.3}),$=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.4}),K=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.45}),Q=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.5}),Z=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.55}),ee=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.6}),te=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.65}),ne=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.7}),ie=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.75}),ae=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:!0,side:THREE.BackSide,depthWrite:!1,depthTest:!1,opacity:.8}),oe=new THREE.CircleGeometry(.5,20),re=new THREE.Mesh(oe,new THREE.MultiMaterial([J,$,K,Q,Z,ee,te,ne,ie,ae]));re.scale.set(1.1,1.1,1.1);new THREE.Object3D;return function(){var t,n,i;(u=new THREE.PerspectiveCamera(20,window.innerWidth/window.innerHeight,1,1e4)).position.z=L,g=new THREE.Scene;var r=new THREE.PointLight(16777215,.25,1e6);r.position.set(0,1e4,0),g.add(r);var s=new THREE.PointLight(16777215,.25,1e6);s.position.set(0,-1e4,0),g.add(s);var l=new THREE.PointLight(16777215,2,1e6);l.position.set(1e4,0,0),g.add(l);var p=new THREE.PointLight(16777215,2,1e6);p.position.set(-1e4,0,0),g.add(p);var h=new THREE.PointLight(16777215,2,1e6);h.position.set(0,0,1e4),g.add(h);var y=new THREE.PointLight(16777215,2,1e6);y.position.set(0,0,-1e4),g.add(y),g.add(re);var m=new THREE.SphereGeometry(b,100,100);t=Shaders.earth,(n=THREE.UniformsUtils.clone(t.uniforms)).texture.value=THREE.ImageUtils.loadTexture(x+"earth_large-8192x4096.jpg"),i=new THREE.ShaderMaterial({uniforms:n,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,transparent:!0,wireframe:!1,depthWrite:!1,depthTest:!1,opacity:.9}),(f=new THREE.Mesh(m,i)).rotation.y=Math.PI,f.name="globe",g.add(f),i=new THREE.MeshBasicMaterial({map:Y,transparent:!0,wireframe:!0,depthWrite:!1,depthTest:!1,opacity:.02});var w=new THREE.SphereGeometry(b-1,100,100),H=new THREE.Mesh(w,i);H.name="meshGlobeUnderlay",g.add(H);var S=ShadersOverlay.earth,C=THREE.UniformsUtils.clone(S.uniforms);C.texture.value=THREE.ImageUtils.loadTexture(x+"stars.jpg"),X=new THREE.ShaderMaterial({uniforms:C,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,transparent:!0,wireframe:!1,side:THREE.BackSide,opacity:.2});var k=new THREE.SphereGeometry(b+400,20,20),B=new THREE.Mesh(k,X);B.rotation.y=Math.PI,B.name="globeOverlay",g.add(B);var D=new THREE.MeshBasicMaterial({map:_,transparent:!0,side:THREE.DoubleSide,depthWrite:!1,depthTest:!1,opacity:.2});P.aws={},P.aws.regions={},P.aws.regions["us-east-1"]={lat:37,lon:-77,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["us-east-2"]={lat:40,lon:-83,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["us-west-1"]={lat:44,lon:-120,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["us-west-2"]={lat:39,lon:-122,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ca-central-1"]={lat:46,lon:-75,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["eu-west-1"]={lat:53,lon:-8,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["eu-west-2"]={lat:51.5,lon:0,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["eu-central-1"]={lat:50,lon:8.5,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ap-northeast-1"]={lat:35.7,lon:139.7,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ap-northeast-2"]={lat:37.5,lon:127,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ap-southeast-1"]={lat:1.3,lon:104,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ap-southeast-2"]={lat:-33.8,lon:150,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["ap-south-1"]={lat:19,lon:73,pivot:new THREE.Object3D,point:new THREE.Geometry},P.aws.regions["sa-east-1"]={lat:-23.5,lon:-46.5,pivot:new THREE.Object3D,point:new THREE.Geometry};for(var j in P)for(var G in P[j].regions)e(P[j].regions[G].lat,P[j].regions[G].lon,D,G);(T=new THREE.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),T.domElement.style.position="absolute",M.appendChild(T.domElement),M.addEventListener("mousedown",o,!1),M.addEventListener("dblclick",a,!1),M.addEventListener("mousewheel",d,!1),document.addEventListener("keydown",E,!1),document.addEventListener("keyup",v,!1),window.addEventListener("resize",c,!1),M.addEventListener("mouseover",function(){M.style.cursor="all-scroll",R=!0},!1),M.addEventListener("mouseout",function(){R=!1},!1)}(),setInterval(function(){requestAnimationFrame(y)},1e3/60),window.addEventListener("mousemove",r,!1),window.requestAnimationFrame(y),this.load=function(e,n){if(n.length>0){window.data=n;for(var i=[],a=0;a<n.length;a++)if("billing"==e){var o=new Date,r=month[o.getMonth()];document.getElementById("billingTotal").innerHTML="$"+n[a]+" ("+r+")"}else if("traffic"==e)for(var s=0;s<n[a].connections.length;s++)addTrafficEvent(n[a].id,n[a].connections[s]);else{if("apigateway"==n[a].type)n[a]=translateApiGateway(n[a]);else{if("elb"!=n[a].type)continue;n[a]=translateElb(n[a])}if("terminated"==n[a].status)void 0!=inventory[n[a].type]&&void 0!=inventory[n[a].type][n[a].id]&&delete inventory[n[a].type][n[a].id];else{void 0==inventory[n[a].type]&&(inventory[n[a].type]={}),void 0==inventory[n[a].type][n[a].id]&&(inventory[n[a].type][n[a].id]={},inventory[n[a].type][n[a].id]=n[a],i.push(n[a]));for(var l=0;l<inventoryFields.length;l++)n[a][inventoryFields[l]]instanceof Array?void 0!=n[a][inventoryFields[l]]&&JSON.stringify(n[a][inventoryFields[l]])!=JSON.stringify(inventory[n[a].type][n[a].id][inventoryFields[l]])&&(inventory[n[a].type][n[a].id][inventoryFields[l]]=n[a][inventoryFields[l]]):void 0!=n[a][inventoryFields[l]]&&n[a][inventoryFields[l]]!=inventory[n[a].type][n[a].id][inventoryFields[l]]&&(inventory[n[a].type][n[a].id][inventoryFields[l]]=n[a][inventoryFields[l]],inventory[n[a].type][n[a].id].mesh.material.map=m(n[a]))}}if(i.length>0)for(var d in P.aws.regions)t(d),firstInventorySetLoaded||(getInitialTimeLineData(),firstInventorySetLoaded=!0);document.body.style.backgroundImage="none"}},this.elementShadowIntensity=2,this.scene=g,this.setCameraPosition=w,this.clouds=P,this.globeRadius=b,this.regionOffset=C,this.updateHeatMap=function(){void 0!=g.getObjectByName("heatMapMesh")&&g.remove(g.getObjectByName("heatMapMesh"));var e=null,t=null,n=new THREE.Geometry,i=new THREE.Mesh(oe),a=0,o=0;for(var r in heatMapHistory){(o=heatMapHistory[r].count-heatMapAverage)<1&&(o=1),a=Math.floor(scaleBetween(o,1,99,1,heatMapHigh))/100,e=(90-heatMapHistory[r].lat)*Math.PI/180,t=(180-heatMapHistory[r].lon)*Math.PI/180,i.position.x=b*Math.sin(e)*Math.cos(t),i.position.y=b*Math.cos(e),i.position.z=b*Math.sin(e)*Math.sin(t),i.lookAt(f.position),i.updateMatrix();for(var s=0;s<i.geometry.faces.length;s++)i.geometry.faces[s].materialIndex=Math.floor(10*a);n.merge(i.geometry,i.matrix)}var l=new THREE.Mesh(n,new THREE.MultiMaterial([J,$,K,Q,Z,ee,te,ne,ie,ae]));l.name="heatMapMesh",g.add(l)},this.globeMesh=f,this.runLoginAnimation=function(){g.getObjectByName("globe").material.depthWrite=!0,g.getObjectByName("globe").material.depthTest=!0,g.getObjectByName("globeOverlay").visible=!1},this.timeWarpSpinMove=p,this.enhance=a,this.zoomReset=function(){setTimeout(function(){F=1e3},100)},this};