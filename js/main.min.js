var Globe=function(){var e=document.getElementById("container");var t="images/";var a,n,r;var i,o;var s,l;var d=200;var E=0;var v=50;var p=false;var f=null;var h=null;var c=13;var u=15;var y=u;var w=9;var m=u;var T=new THREE.Raycaster;var g=new THREE.Vector2;var R={x:0,y:0};var H={x:0,y:0},M={x:Math.PI*3/2.5,y:Math.PI/7},x={x:0,y:0};var b=1e5,S=1e3;var k=40;var C=Math.PI/2;var B=2;var D=null;var G=[];var L={};var O=document.createElement("canvas");O.width=256;O.height=256;var F=O.getContext("2d").createLinearGradient(256,0,256,256);F.addColorStop(0,"#0080ff");F.addColorStop(.2,"#0065ff");F.addColorStop(.5,"#0055ff");F.addColorStop(.8,"#0065ff");F.addColorStop(1,"#0080ff");O.getContext("2d").fillStyle=F;O.getContext("2d").fillRect(0,0,256,256);var j=new THREE.CanvasTexture(O);var I=Ee("rgb(256,256,256)");var P=Ee("rgb(256,0,0)");var A=Ee("rgb(256,256,0)");var W=Ee("rgb(179, 71, 0)");var z=Ee("rgb(256,256,256)");var N=Ee("rgb(50,50,50)");var U=N;var q=Ee("rgb(0, 173, 239)");var Y=null;var X=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.3});var _=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.4});var J=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.45});var V=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.5});var $=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.55});var K=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.6});var Q=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.65});var Z=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.7});var ee=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.75});var te=new THREE.MeshBasicMaterial({color:16777215,vertexColors:THREE.FaceColors,transparent:true,side:THREE.BackSide,depthWrite:false,depthTest:false,opacity:.8});var ae=new THREE.CircleGeometry(.5,20);var ne=new THREE.Mesh(ae,new THREE.MultiMaterial([X,_,J,V,$,K,Q,Z,ee,te]));ne.scale.set(1.1,1.1,1.1);var re=new THREE.Object3D;function ie(){var o,l,E,v,p;var f,h;a=new THREE.PerspectiveCamera(20,window.innerWidth/window.innerHeight,1,1e4);a.position.z=b;n=new THREE.Scene;var c=new THREE.PointLight(16777215,.25,1e6);c.position.set(0,1e4,0);n.add(c);var u=new THREE.PointLight(16777215,.25,1e6);u.position.set(0,-1e4,0);n.add(u);var y=new THREE.PointLight(16777215,2,1e6);y.position.set(1e4,0,0);n.add(y);var w=new THREE.PointLight(16777215,2,1e6);w.position.set(-1e4,0,0);n.add(w);var m=new THREE.PointLight(16777215,2,1e6);m.position.set(0,0,1e4);n.add(m);var T=new THREE.PointLight(16777215,2,1e6);T.position.set(0,0,-1e4);n.add(T);n.add(ne);var v=new THREE.SphereGeometry(d,100,100);o=Shaders["earth"];l=THREE.UniformsUtils.clone(o.uniforms);l["texture"].value=THREE.ImageUtils.loadTexture(t+"earth_large-8192x4096.jpg");E=new THREE.ShaderMaterial({uniforms:l,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:true,wireframe:false,depthWrite:false,depthTest:false,opacity:.9});i=new THREE.Mesh(v,E);i.rotation.y=Math.PI;i.name="globe";n.add(i);E=new THREE.MeshBasicMaterial({map:q,transparent:true,wireframe:true,depthWrite:false,depthTest:false,opacity:.02});var g=new THREE.SphereGeometry(d-1,100,100);var R=new THREE.Mesh(g,E);R.name="meshGlobeUnderlay";n.add(R);var H=ShadersOverlay["earth"];var M=THREE.UniformsUtils.clone(H.uniforms);M["texture"].value=THREE.ImageUtils.loadTexture(t+"stars.jpg");Y=new THREE.ShaderMaterial({uniforms:M,vertexShader:H.vertexShader,fragmentShader:H.fragmentShader,transparent:true,wireframe:false,side:THREE.BackSide,opacity:.2});var x=new THREE.SphereGeometry(d+400,20,20);var S=new THREE.Mesh(x,Y);S.rotation.y=Math.PI;S.name="globeOverlay";n.add(S);var k=new THREE.MeshBasicMaterial({map:z,transparent:true,side:THREE.DoubleSide,depthWrite:false,depthTest:false,opacity:.2});L.aws={};L.aws.regions={};L.aws.regions["us-east-1"]={lat:37,lon:-77,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["us-east-2"]={lat:40,lon:-83,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["us-west-1"]={lat:44,lon:-120,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["us-west-2"]={lat:39,lon:-122,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ca-central-1"]={lat:46,lon:-75,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["eu-west-1"]={lat:53,lon:-8,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["eu-west-2"]={lat:51.5,lon:0,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["eu-central-1"]={lat:50,lon:8.5,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ap-northeast-1"]={lat:35.7,lon:139.7,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ap-northeast-2"]={lat:37.5,lon:127,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ap-southeast-1"]={lat:1.3,lon:104,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ap-southeast-2"]={lat:-33.8,lon:150,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["ap-south-1"]={lat:19,lon:73,pivot:new THREE.Object3D,point:new THREE.Geometry};L.aws.regions["sa-east-1"]={lat:-23.5,lon:-46.5,pivot:new THREE.Object3D,point:new THREE.Geometry};for(var C in L){for(var B in L[C].regions){se(L[C].regions[B].lat,L[C].regions[B].lon,k,B)}}r=new THREE.WebGLRenderer({antialias:true});r.setSize(window.innerWidth,window.innerHeight);r.domElement.style.position="absolute";e.appendChild(r.domElement);e.addEventListener("mousedown",fe,false);e.addEventListener("dblclick",ve,false);e.addEventListener("mousewheel",ye,false);document.addEventListener("keydown",we,false);document.addEventListener("keyup",Te,false);window.addEventListener("resize",ge,false);e.addEventListener("mouseover",function(){e.style.cursor="all-scroll";s=true},false);e.addEventListener("mouseout",function(){s=false},false)}function oe(){if(n.getObjectByName("heatMapMesh")!=undefined){n.remove(n.getObjectByName("heatMapMesh"))}var e=null;var t=null;var a=new THREE.Geometry;var r=new THREE.Mesh(ae);var o=0;var s=0;for(var l in heatMapHistory){s=heatMapHistory[l].count-heatMapAverage;if(s<1){s=1}o=Math.floor(scaleBetween(s,1,99,1,heatMapHigh))/100;e=(90-heatMapHistory[l].lat)*Math.PI/180;t=(180-heatMapHistory[l].lon)*Math.PI/180;r.position.x=d*Math.sin(e)*Math.cos(t);r.position.y=d*Math.cos(e);r.position.z=d*Math.sin(e)*Math.sin(t);r.lookAt(i.position);r.updateMatrix();for(var E=0;E<r.geometry.faces.length;E++){r.geometry.faces[E].materialIndex=Math.floor(o*10)}a.merge(r.geometry,r.matrix)}var v=new THREE.Mesh(a,new THREE.MultiMaterial([X,_,J,V,$,K,Q,Z,ee,te]));v.name="heatMapMesh";n.add(v)}function se(e,t,a,r){var o=(90-e)*Math.PI/180;var s=(180-t)*Math.PI/180;var l=1;L.aws.regions[r].pivot.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-u));var E=new THREE.PlaneGeometry(0,0,1);E.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-u));var v=new THREE.Mesh(E,a);v.position.x=d*Math.sin(o)*Math.cos(s);v.position.y=d*Math.cos(o);v.position.z=d*Math.sin(o)*Math.sin(s);v.scale.z=Math.max(l,.1);v.lookAt(i.position);v.name=r;v.type="region";n.add(v);v.add(L.aws.regions[r].pivot);var p=new THREE.Object3D;p.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,u/2));L.aws.regions[r].pivot.add(p);E=new THREE.ConeGeometry(3,u,4,1,true,Math.PI/4,2*Math.PI);var f=new THREE.MeshBasicMaterial({map:z,transparent:true,depthWrite:false,depthTest:false,opacity:.3});var h=new THREE.Mesh(E,f);h.name=r+"Cone";n.add(h);p.add(h);p.rotation.x+=C;E=new THREE.PlaneGeometry(1,1,1);E.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-u-2));var c=new THREE.Mesh(E,a);v.add(c)}function le(e){var t=4;var a=[];for(var r in inventory){for(var i in inventory[r]){if(inventory[r][i].Region==e){a.push(inventory[r][i])}}}var o=Math.ceil(Math.sqrt(a.length));var s=Math.round(Math.sqrt(a.length));var l=n.getObjectByName(e);var d=o*t;var E=s*t;var v=0;var p=0;var f=0;var h=0;var c=false;var u,y;var w;var m=0;var T=0;for(u=0;u<a.length;u++){w=false;if(s==1){m=v*t-(s*t-t)}else{m=v*t-(s*t-t)/2}if(o==1){T=f*t-(o*t-t)}else{T=f*t-(o*t-t)/2}for(y=0;y<l.children[0].children.length;y++){if(l.children[0].children[y].name==a[u].id){l.children[0].children[y].position.x=m;l.children[0].children[y].position.y=T;w=true;break}}if(!w){de(a[u],m,T)}if(v>p){p=v}if(f>h){h=f}if(f>v){if(!c){v++;f=0}else{if(f==v+1){c=false;v++;f=0}else{v++}}}else if(f<v){f++}else if(f==v){if(!c){f++;v=0;c=true}}}if(E<4){E=4}if(d<4){d=4}l.children[1].scale.set(E+2,d+2,1)}function de(e,t,a){var r;var o;var s=new THREE.MeshLambertMaterial({map:be(e),transparent:true,side:THREE.DoubleSide,opacity:.9});if(e.type=="elb"){r=1;o=new THREE.Geometry;s.wireframe=true;var l=new THREE.OctahedronGeometry(1.4,2);l.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-2.5));var d=new THREE.Mesh(l,s);var E=0;var v=0;var p={left:0,center:0,right:0};var f={left:0,center:0,right:0};E=.1;v=.6;f.center=-1.4;f.left=f.center;f.right=f.center;p.left=.8;p.right=-.8;var h=new THREE.BoxGeometry(E,v,.5);h.applyMatrix((new THREE.Matrix4).makeTranslation(p.center,f.center,-2.5));var c=new THREE.Mesh(h,s);var u=new THREE.BoxGeometry(E,v,.5);u.applyMatrix((new THREE.Matrix4).makeTranslation(p.left,f.left,-2.5));var y=new THREE.Mesh(u,s);var w=new THREE.BoxGeometry(E,v,.5);w.applyMatrix((new THREE.Matrix4).makeTranslation(p.right,f.right,-2.5));var m=new THREE.Mesh(w,s);var T=new THREE.BoxGeometry(E,v,.5);T.applyMatrix((new THREE.Matrix4).makeTranslation(-p.center,-f.center,-2.5));var g=new THREE.Mesh(T,s);o.merge(d.geometry,d.matrix);o.merge(c.geometry,c.matrix);o.merge(y.geometry,y.matrix);o.merge(m.geometry,m.matrix);o.merge(g.geometry,g.matrix)}else if(e.type=="apigateway"){r=3;o=new THREE.TorusGeometry(1.5,.2,10,28);o.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,-.5));s.wireframe=true}var R=new THREE.Mesh(o,s);R.scale.z=Math.max(r,.1);R.lookAt(i.position);R.name=e.id;R.type=e.type;R.position.x=t;R.position.y=a;R.position.z=0;n.add(R);if(e.Region!=undefined){L.aws.regions[e.Region].pivot.add(R)}inventory[e.type][e.id].mesh=R;n.updateMatrixWorld(true)}function Ee(e){var t=document.createElement("canvas");t.width=256;t.height=256;t.getContext("2d").fillStyle=e;t.getContext("2d").fillRect(0,0,256,256);return new THREE.CanvasTexture(t)}function ve(){new Audio("sounds/Tick-DeepFrozenApps-397275646.mp3").play();document.getElementById("enhanceFrame").style.display="block";setTimeout(function(){document.getElementById("enhanceFrame").style.display="none";Re((S-210)/1.5)},100)}function pe(){setTimeout(function(){S=1e3},100)}function fe(t){t.preventDefault();p=true;e.addEventListener("mousemove",he,false);e.addEventListener("mouseup",ce,false);e.addEventListener("mouseout",ue,false);R.x=-t.clientX;R.y=t.clientY;x.x=M.x;x.y=M.y}function he(e){g.x=e.clientX/window.innerWidth*2-1;g.y=-(e.clientY/window.innerHeight)*2+1;if(p){l=b/1e3;M.x=x.x+(-e.clientX-R.x)*.005*l;M.y=x.y+(e.clientY-R.y)*.005*l;M.y=M.y>C?C:M.y;M.y=M.y<-C?-C:M.y}}function ce(t){p=false;e.removeEventListener("mousemove",he,false);e.removeEventListener("mouseup",ce,false);e.removeEventListener("mouseout",ue,false)}function ue(t){e.removeEventListener("mousemove",he,false);e.removeEventListener("mouseup",ce,false);e.removeEventListener("mouseout",ue,false)}function ye(e){e.preventDefault();if(s){Re(e.wheelDeltaY*.3)}return false}function we(e){switch(e.keyCode){case 13:if(document.activeElement.id=="password"){loginAndLoadInventory()}e.preventDefault();break;case 16:holdingShift=true;e.preventDefault();break;case 17:toggleRotate();e.preventDefault();break;case 18:holdingAlt=true;e.preventDefault();break;case 37:if(holdingAlt){M.x-=3}else{M.x-=.1}e.preventDefault();break;case 38:if(holdingShift){M.y+=.05;M.y=M.y>C?C:M.y;M.y=M.y<-C?-C:M.y}else{Re(20)}e.preventDefault();break;case 39:if(holdingAlt){M.x+=3}else{M.x+=.1}e.preventDefault();break;case 40:if(holdingShift){M.y-=.05;M.y=M.y>C?C:M.y;M.y=M.y<-C?-C:M.y}else{Re(-20)}e.preventDefault();break;default:new Audio("sounds/Pen_Clicks-Simon_Craggs-514025171.mp3").play();break}}function me(e){if(e==undefined){e=20}else{e--}if(e==0){startRotation();return}setTimeout(function(){M.x+=e/3;me(e)},10)}function Te(e){switch(e.keyCode){case 16:holdingShift=false;e.preventDefault();break;case 18:holdingAlt=false;e.preventDefault();break}}function ge(e){a.aspect=window.innerWidth/window.innerHeight;a.updateProjectionMatrix();r.setSize(window.innerWidth,window.innerHeight)}function Re(e){if(e>0){slidePanes("out");stopRotation()}else{slidePanes("in")}S-=e;S=S>1e3?1e3:S;S=S<210?210:S}function He(){setInterval(function(){requestAnimationFrame(Me)},1e3/60)}function Me(){H.x+=(M.x-H.x)*.1;H.y+=(M.y-H.y)*.1;b+=(S-b)*.3;a.position.x=b*Math.sin(H.x)*Math.cos(H.y);a.position.y=b*Math.sin(H.y);a.position.z=b*Math.cos(H.x)*Math.cos(H.y);a.lookAt(i.position);if(rotate){M.x-=.001}r.render(n,a);frames++}function xe(){n.getObjectByName("globe").material.depthWrite=true;n.getObjectByName("globe").material.depthTest=true;n.getObjectByName("globeOverlay").visible=false}function be(e){if(e.health=="fail"){return P}else{if(e.status=="running"){if(e.cpu!=undefined&&e.cpu.Average!=undefined){if(e.cpu.Average>=0&&e.cpu.Average<75){return j}else if(e.cpu.Average>=75&&e.cpu.Average<90){return A}else{return W}}else{return j}}else if(e.status=="pending"||e.status=="rebooting"||e.status=="creating"){return z}else if(e.status=="stopped"){return N}else if(e.status=="stopping"||e.status=="shutting-down"){return U}}}function Se(e,t,n){var r=true;S=1e3;if(Math.abs(a.position.x-e)>500||(n>0&&a.position.z<0||n<0&&a.position.z>0)){M.x-=.03;r=false}else if(Math.abs(a.position.x-e)>400||(n>0&&a.position.z<0||n<0&&a.position.z>0)){M.x-=.01;r=false}else if(Math.abs(a.position.x-e)>100||(n>0&&a.position.z<0||n<0&&a.position.z>0)){M.x-=.001;r=false}if(Math.abs(a.position.y-t)>100){if(a.position.y<t){M.y+=.01}else{M.y-=.01}r=false}if(r){stopRotation()}else{setTimeout(function(){Se(e,t,n)},10)}}function ke(e,t){if(t.length>0){window.data=t;var a=[];var n=false;var r=false;var i=false;for(var o=0;o<t.length;o++){if(e=="billing"){var s=new Date;var l=month[s.getMonth()];document.getElementById("billingTotal").innerHTML="$"+t[o]+" ("+l+")"}else if(e=="traffic"){r=true;for(var d=0;d<t[o].connections.length;d++){addTrafficEvent(t[o].id,t[o].connections[d])}}else{i=true;if(t[o].type=="apigateway"){t[o]=translateApiGateway(t[o])}else if(t[o].type=="elb"){t[o]=translateElb(t[o])}else{continue}if(t[o].status=="terminated"){if(inventory[t[o].type]!=undefined){if(inventory[t[o].type][t[o].id]!=undefined){delete inventory[t[o].type][t[o].id]}}}else{if(inventory[t[o].type]==undefined){inventory[t[o].type]={}}if(inventory[t[o].type][t[o].id]==undefined){inventory[t[o].type][t[o].id]={};inventory[t[o].type][t[o].id]=t[o];a.push(t[o])}n=false;for(var E=0;E<inventoryFields.length;E++){if(t[o][inventoryFields[E]]instanceof Array){if(t[o][inventoryFields[E]]!=undefined&&JSON.stringify(t[o][inventoryFields[E]])!=JSON.stringify(inventory[t[o].type][t[o].id][inventoryFields[E]])){inventory[t[o].type][t[o].id][inventoryFields[E]]=t[o][inventoryFields[E]];n=true}}else if(t[o][inventoryFields[E]]!=undefined&&t[o][inventoryFields[E]]!=inventory[t[o].type][t[o].id][inventoryFields[E]]){inventory[t[o].type][t[o].id][inventoryFields[E]]=t[o][inventoryFields[E]];inventory[t[o].type][t[o].id].mesh.material.map=be(t[o]);n=true}}}}}if(a.length>0){for(var v in L.aws.regions){le(v);if(!firstInventorySetLoaded){getInitialTimeLineData();firstInventorySetLoaded=true}}}document.body.style.backgroundImage="none"}}ie();He();window.addEventListener("mousemove",he,false);window.requestAnimationFrame(Me);this.load=ke;this.elementShadowIntensity=B;this.scene=n;this.setCameraPosition=Se;this.clouds=L;this.globeRadius=d;this.regionOffset=u;this.updateHeatMap=oe;this.globeMesh=i;this.runLoginAnimation=xe;this.timeWarpSpinMove=me;this.enhance=ve;this.zoomReset=pe;return this};